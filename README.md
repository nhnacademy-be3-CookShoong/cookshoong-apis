# 쿡슝(Cook-Shoong)
![](https://velog.velcdn.com/images/eora21/post/9b2cc6a2-84df-4ff6-9c1c-338c53c7f22e/image.png)

## 팀원
### [김주호 (eora21)](https://github.com/eora21)
### [유승연 (seong1542)](https://github.com/seong1542)
### [윤동현 (Dendroh)](https://github.com/Dendroh)
### [정제완 (JeongJeWan)](https://github.com/JeongJeWan)
### [추만석 (10kseok)](https://github.com/10kseok)


## 서비스 소개
음식배송 Application ....

## 아키텍처
도식화 하여 이미지로 첨부

## 일정관리

## CI/CD
도식화 하여 이미지로 첨부

## 프로젝트 관리
github project 링크 추가하고 프로젝트를 어떻게 진행 했다 간단한 설명 추가.

ex) 스크럼을 xxx하게 진행하고, WBS로 일정관리하고 ... 이슈등록해서 ... git-flow사용하고.. 등등 ... 대략적으로.. 설명.

## 일정관리 ( WBS )
![image](https://github.com/nhnacademy-be3-CookShoong/cookshoong-backend/assets/61442066/5ce24e84-5435-452b-9588-26a8a0539662)

## github project 링크추가 ( RoadMap) 및 스크린샷 이미지 첨부
일정관리를 이렇게 했다 정도의 간단한 설명.

## 칸반보드
github project 링크추가 및 스크린샷 이미지 첨부

## 테스트 커버리지
마지막으로 측정된(최종) 이미지로 첨부

## REST API Specification
외부에서 확인할 수 있는 링크

# 주요 기능

## 인증/인가
> Cookshoong 서비스 이용자임을 증명을 확인하고 서비스를 이용할 수 있게 합니다.

### 담당자
- 추만석

### 기능
- 인증서버에서 자격증명 확인 후 JWT 발급합니다.
- JWT는 액세스토큰과 리프레쉬 토큰 두 개로 발급합니다.
- 리프레쉬 토큰을 통해 토큰 재발급이 가능합니다.
- 게이트웨이에서 JWT 검증하여 인증된 사용자만이 백엔드 API 호출을 가능하게 합니다.
- 프론트서버에서는 발급받은 JWT를 이용한 백엔드 API 호출을 합니다.

## 회원
> 사용자가 Cookshoong 서비스에 간편하게 가입할 수 있도록 돕습니다.

### 담당자
- 추만석
- 유승연

### 기능
- Cookshoong 서비스를 이용하기 위한 회원가입이 가능합니다.
- OAuth2에서 받은 권한으로 간편 회원가입이 가능합니다.
- 등록된 자신의 정보를 수정할 수 있습니다.
- 일반 회원, 사업자 회원, 관리자로 나눠서 관리합니다.
- 일반 회원은 매장 또는 메뉴 조회, 주문의 권한을 가집니다.
- 사업자 회원은 일반 회원의 권한보다 상위 권한을 가지며 매장을 등록할 수 있습니다.
- 관리자는 일반, 사업자 회원보다 높은 권한을 가지며 서비스 이용에 모든 권한을 가집니다.

- 회원의 마지막 로그인 기록이 90일 이전일 경우 스프링배치와 스케줄러를 이용하여 회원을 휴면상태로 변경함.
- 스프링배치를 이용하여 매월 5일 회원의 이전 달에 주문완료(COMPLETE)된 주문들의 횟수를 기준으로 회원의 등급을 재산정함.
- 재산정한 등급을 기준으로 매월 5일 각 등급에 따라 쿠폰을 발급.

### 사용된 기술 및 API
스프링배치, Mybatis, Quartz 스케줄러

## 주소
> 사용자가 해당 주소를 사용함으로써 편리하게 배달을 받을 수 있고, 매장 또한 주소를 등록해 놓으므로써 사용자가 쉽게 위치를 알 수 있다.

### 담당자
정제완
### 기능
주소 저장, 삭제, 선택, 주소록 조회, 현재 위치 가져오기
### 설명
kakao map 을 활용하여 회원 및 매장 주소 등록 및 현재 위치 가져오기 기능 적용
최신 주소지를 통해 매장 보기 및 주문시 편리함을 부여
주소록은 최대 10개까지 등록이 가능하도록 설정
사용자에 주소로부터 3km 이내 위치한 매장 불러오기
## 매장

### 담당자
- 유승연

### 기능
- 사업자 : 매장 조회, 등록 및 수정, 매장의 상태변경, 본인 매장 리스트 관리, 영업시간과 휴무시간 기준으로 영업 상태 변경 처리.
- 관리자 : 매장 등록에 필요한 은행, 카테고리, 가맹점 등을 등록, 조회, 수정, 삭제하여 관리
- 사용자 : 해당 매장 조회

### 사용된 기술 및 API
- Spring JPA, Object Storage, Mysql, Thymeleaf, Javascript, toast ui editor 사용

### 설명
- 매장 사진, 사업자 등록증과 같은 대용량 파일에 대한 저장을 ObjectStorage 또는 Local에 등록하여 관리할 수 있도록 구현.
- 개발자가 ObjectStorage 외에 또다른 저장소가 붙었을 경우를 대비하여 proxy패턴을 이용하여 구현.
- 사용자가 메인 페이지에 접근했을 때 혹은 엘라스틱서치가 매장에 대한 정보를 보여줄 때 매장의 영업 정보 및 휴무일을 기준으로 자동으로 영업상태를 변경할 수 있도록 구현. 
- (영업상태는 총 4가지로, 사업자가 지정한 영업시간을 기준으로 자동으로 OPEN, BREAKTIME을 가질 수 있고, 영업중 강제로 영업을 멈추기 위한 CLOSE상태를 추가하였습니다. 해당 상태에서 자동으로 넘어가면 안되기 때문에 CLOSE 상태일 경우 자동 업데이트를 하지 않도록 하였습니다. 또한 영업을 영구중단한 매장의 경우 사용자들에게 보이지 않더라도 사업자에게 중요 정보가 있을 수 있기 때문에 매장을 삭제하지않고 단순 조회만 가능하도록 구현하였습니다.)
- 매장 및 서비스의 주요 코드들을 관리할 수 있는 관리자 페이지 구현.
- toast ui editor을 이용하여 사장님들이 다양하고 예쁘게 매장 설명 가능하도록 구현.
- 매장 등록, 수정, 조회, 상태 변경 등 구현

## 메뉴

### 기능
- 사업자가 메뉴 등록 시 이미지 업로드, 수정이 가능하도록 구현

## 장바구니
> 사용자가 주문하고자 하는 메뉴를 담아 편리하게 주문을 할 수 있다.

### 담당자
- 정제완
### 기능
- Redis 를 통해 장바구니 저장, 조회, 수정, 삭제 구현
### 설명
- Redis 장바구니를 통해 빈번한 조회 및 수정을 처리
- Phantom key 를 활용해서 Redis key 가 만료되기 전에 DB에 장바구니를 영구저장
- 조회 시 Redis 에 존재하지 않고 DB 에 있을 시 DB 장바구니 정보를 Redis 에 저장
## 주문
> 사용자가 음식을 주문할 수 있습니다.

### 담당자
- 김주호

### 기능
- 장바구니에 담은 음식들을 주문합니다.
- 장바구니에 음식을 담지 않았을 경우, 주문 화면으로 넘어갈 수 없습니다.
- 최소 주문 금액을 충족하지 못 했을 시, 주문 화면으로 넘어갈 수 없습니다.
- 최대 주문 거리를 넘었을 시, 주문 화면으로 넘어갈 수 없습니다.
- 쿠폰, 포인트를 적용하여 총 금액을 할인받을 수 있습니다.
- 주문을 받은 사장님은 주문 관리 페이지에서 해당 주문을 수락하고 배달 요청을 하거나, 혹은 취소할 수 있습니다.
- 주문 기록은 마이페이지에서 확인할 수 있습니다.

### 설명
- 주문이 생성 가능한지, 적용된 쿠폰과 포인트가 사용 가능한 지 검증합니다.
- 실제 쿠폰과 포인트는 결제되며 소비됩니다.

### 사용된 기술 및 API
- JPA
- QueryDSL
- Thymeleaf
- JS

## 결제 및 환불
> 사용자가 주문한 내역들을 토스 API 를 통해 간편하게 결제할 수 있다.

### 담당자
- 정제완
### 기능
- 토스 API 사용
- 토스 결제 및 취소 완료 후 데이터 저장
### 설명
- 토스 API 를 활용한 결제 승인 및 취소 처리
- 토스 API 를 결제 취소를 활용해 사장님 전액 및 부분환불 처리 구현

## 쿠폰
> 사용자가 음식을 주문할 때, 주문 금액에 대해 고정 금액 또는 퍼센트만큼 할인받아 구입할 수 있게 합니다.

### 담당자
- 김주호

### 기능
- 음식 주문 전, 매장 페이지 혹은 이벤트 페이지에서 쿠폰을 발급받습니다.
- 음식 주문 시, 쿠폰을 선택해 적용합니다.
- 쿠폰은 각각의 최소 주문 금액이 있습니다. 해당 조건을 충족하지 못 하면 주문에 적용할 수 없습니다.
- 퍼센트 쿠폰은 최대 할인 금액이 있습니다. 아무리 높은 가격이더라도 최대 할인 금액까지만 적용됩니다.
- 발급받은 쿠폰은 만료날 전까지 다시 발급받을 수 없습니다.

### 설명
- 많은 사람들이 쿠폰을 발급받는 상황을 가정, RabbitMQ를 사용하여 BE 서버의 부하를 줄였습니다.
- 같은 쿠폰을 발급받지 못 하게끔, 이벤트 발급일 경우 Redis에 쿠폰들의 코드를 Bulk Insert하였습니다. 따라서 트랜잭션 레벨을 올리지 않고도 MQ Consumer가 빠른 속도로 쿠폰을 발급시켜줄 수 있습니다.
- 만약 Redis의 정합성에 문제가 생겨 쿠폰 코드를 가져올 수 없을 경우, MQ Consumer가 DB에 접근해 Redis의 정합성을 다시 맞춰줄 수 있게끔 하였습니다.
- MQ Consumer가 DB에 접근하는 동안 다른 요청들을 막기 위하여 분산 락을 적용하였습니다.
- MQ Consumer가 DB에 접근하고 난 후, 밀린 요청으로 인한 미유효 쿠폰 발급 상황을 막기 위해 낙관적 락을 적용하였습니다.

### 사용된 기술 및 API
- JPA
- QueryDSL
- Redisson
- RabbitMQ
- Redis
- Spring Event
- Thymeleaf
- JS

## 포인트
> 사용자가 음식을 주문할 때, 총 금액에 대해 사용하는 포인트만큼 할인받아 구입할 수 있게 합니다.

### 담당자
- 김주호

### 기능
- 회원 가입, 리뷰 작성, 주문 완료 시 사용자의 포인트가 상승합니다.
- 획득한 포인트는 주문 시 현금처럼 사용할 수 있습니다.
- 사용 및 발급 포인트는 마이페이지에서 확인할 수 있습니다.

### 설명
- 회원 가입, 리뷰 작성, 주문 완료 시 포인트를 제공하기 위해 Spring Event를 구현하였습니다.
- 
### 사용된 기술 및 API
- JPA
- QueryDSL
- Spring Event
- Thymeleaf
- JS

## 리뷰

### 기능
- 주문완료된 건에 대해 사용자가 리뷰를 등록할 수 있고, 리뷰 등록 시 여러 장의 사진을 등록 할 수 있음.
- 일반회원 :  등록한 리뷰에 대해 조회를 할 수 있음.
- 사업자회원 : 본인의 매장에 달린 리뷰를 확인할 수 있고, 해당 리뷰에 답글을 달 수 있음.
- 매장 : 해당 매장에 등록된 전체 리뷰를 조회할 수 있음.

### 사용된 기술
JPA, Thymeleaf, javascript, Mysql, ObjectStorage, toast Ui editor 사용

## 검색
## 파일
## 인프라
## 기술








Spring Cloud Gateway...

프로젝트에서 사용한 기술스택을 작성하세요.
